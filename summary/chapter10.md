질문 리스트

#### 10. 클러스터

- 스케일 업(scale up)이란? 수직 확장(vertical scaling)이란?
  - 스케일 업의 장단점은? 1가지씩
- 스케일 아웃(scale up)이란? 수평 확장(horizontal scaling)이란?
  - 스케일 아웃의 장단점은? 1가지씩

##### 레디스에서의 확장성

- 키의 이빅션란 무엇인가?
- 키의 이빅션을 어떻게 해결해야하는가?
- 스케일 업의 한계는 무엇인가?

##### 레디스 클러스터의 기능

- 레디스 클러스터의 기능이란?
- 레디스 클러스터의 기능을 왜 사용하는가? 

##### 데이터 샤딩

- 샤딩이란? 

그림10-2
- 레디스 클러스터는 어떻게 동작하는가?
    - 데이터는 키를 이용해 샤딩되며 하나의 키는 항상 마스터 노드에 매핑되는가?
    - 클러스터의 모든 노드는 키가 저장돼야할 노드를 알고 있는가?

##### 고가용성

그림10-3

- 클러스터는 최소 3대 마스터노드와 복제본 노드를 갖도록 구성하는가?
- 클러스터의 모든 노드는 TCP로 연결해서 풀 메쉬 토폴로지 형태를 이루는가?
- 클러스터 버스는 무엇인가?

#### 레디스 클러스터 동작 방법
##### 해시 슬롯을 이용한 데이터 샤딩

- 클러스터 구조에서 모든 데이터는 어디에 저장되는가?
- 레디스는 16384개의 헤시 슬록이 있으며 각 데이터는 1개에 해시 슬롯과 맵핑된다. 16348개 이상의 데이터가 쌓이면 키는 어떻게 맵핑되는가?

HASH_SLOT = CRC16(Key) mod 16384
위 공식으로 해시슬롯이 결정된다.
- 해시 슬록은 마스터 노드 내에서 자유롭게 이동할 수 있고 옮겨지는 중에도 데이터는 정상적으로 접근 가능한가? 

##### 해시 태그

- 해시 태그란 무엇인가?
```text
user:{123}:profile
user:{123}:account
```
- 해시 태그를 사용하는 이유는 무엇인가? 
  - MGET 명령어는 무엇인가? 
  - MGET 명령어는 이용하면 다른 마스터 노드의 데이터도 같이 가져올 수있는가?
    - MGET user1:name user2:name
  
###### 레디스 클러스터 운영하기

- 리샤딩이란?

###### 레디스 클러스터 동작 방법

- 하트비트 패킷이란?
  - 하트비트 패킷에 가십 섹션이 포함되는데 가십 섹션은 무엇인가?
  - 에포크란 무엇인가? 
  - 페일 오버와 리샤딩 중에만 해시 슬롯 구성의 변경이 일어나는가? 
  - 해시 슬롯 구성 변경이 일어나면 에포크는 어떻게 되는가?

##### 노드 핸드 쉐이크란

- 노드 핸드 쉐이크란?

##### 리디렉션 

- 리디렉션의 MOVED 와 ASK의 차이는 무엇인가?
- 왜 이런 리디렉션 명령이 따로 있는가?
- 리디렉션의 ASK 명령어는 언제에만 사용되는가? 

###### 장애 감지와 페일오버

- 장애 감지에 사용되는 플래그 PFAIL(partial fail)과 FAIL은 무엇인가?
- PFAIL플래그는 어떤 조건이 되어야 생기는가?
- FAIL플래그는 어떤 조건이 되어야 생기는가?
- FAIL플래그가 되어야 페일 오버를 트리거 시킬 수 있는가? 

##### 복제본을 마스터로 선출

아래 조건이 되면 복제본을 마스터로 선출한다. 
1. 마스터가 FAIL 상태이다. 
2. 마스터는 1개 이상의 해시슬롯을 갖고 있다.
3. 마스터와의 복제가 끊어진 지 오래다.

위 조건을 만족하면 복제본은 아래와 같은 절차를 이용해서 마스터로 선출된다.

1. 복제본은 자기의 에포크값을 1 증가시킨다.
2. 복제본은 FAILOVER_AUTH_REQUEST 패킷을 마스터에게 보내 마스터 인스턴스에 투표 요청을 한다.
3. 마스터는 FAILOVER_AUTH_ACK 패킷으로 긍정적인 응답을 보내 투표에 동의함을 알린다.
4. 다수의 마스터로부터 ACK를 받은 복제본이 마스터 후보로 선출된다.
5. 과반수 이상의 마스터에서 ACK를 받지 못한다면 페일오버는 중단되고 다른 복제본의 투표를 진행한다.